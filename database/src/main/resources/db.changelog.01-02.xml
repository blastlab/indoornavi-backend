<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.3.xsd">
	<changeSet id="dbUpdate1-2.1" author="gkonupek">
		<addColumn tableName="Goal">
			<column name="floor_id" type="INT">
				<constraints nullable="false"/>
			</column>
			<column name="x" type="DOUBLE">
				<constraints nullable="false"/>
			</column>
			<column name="y" type="DOUBLE">
				<constraints nullable="false"/>
			</column>
		</addColumn>
	</changeSet>

	<changeSet id="dbUpdate1-2.2" author="gkonupek">
		<sql>
			UPDATE Goal g INNER JOIN Vertex v ON (g.vertex_id = v.id)
			SET
			g.x = v.x,
			g.y = v.y,
			g.floor_id = v.floor_id
			;
		</sql>
	</changeSet>

	<changeSet id="dbUpdate1-2.3" author="gkonupek">
		<addForeignKeyConstraint baseColumnNames="floor_id" baseTableName="Goal"
		                         referencedColumnNames="id" referencedTableName="Floor"
		                         constraintName="FK_Goal_Floor" onDelete="CASCADE" onUpdate="CASCADE"/>
	</changeSet>

	<changeSet id="dbUpdate1-2.4" author="gkonupek">
		<dropForeignKeyConstraint baseTableName="Goal" constraintName="FK_Goal_Building"/>
	</changeSet>

	<changeSet id="dbUpdate1-2.5" author="gkonupek">
		<dropForeignKeyConstraint baseTableName="Goal" constraintName="FK_Goal_Vertex"/>
	</changeSet>

	<changeSet id="dbUpdate1-2.6" author="gkonupek">
		<dropColumn tableName="Goal">
			<column name="vertex_id"/>
			<column name="building_id"/>
		</dropColumn>
	</changeSet>

	<changeSet id="addUniqueConstraint1-1" author="jsmolkowska">
		<addUniqueConstraint tableName="beacon" columnNames="minor, major"
		                     constraintName="unique_minor_major"/>
	</changeSet>

</databaseChangeLog>