<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Title</title>
</head>
<style>
	#container {
		width: 1500px;
		height: 1500px;
		background: grey;
		position: relative;
	}

	.square {
		width: 5px;
		height: 5px;
		background: white;
		position: absolute;
	}

	.red {
		background-color: red;
	}
</style>
<body>
<div id="container">
	<form>
		<div id="checkboxes"></div>
	</form>
</div>
</body>
<script
	src="https://code.jquery.com/jquery-3.1.1.min.js"
	integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
	crossorigin="anonymous"></script>
<script>
	$(document).ready(function () {
		var $container = $('#container');
		var isConnectionOpen = false;
		var socket = new WebSocket("ws://localhost:80/coordinates?client");
		var message = {
			color: ''
		};
		var tags = [];

		socket.onopen = function () {
			console.log('connection opened');
			isConnectionOpen = true;
		};

		socket.onclose = function () {
			console.log('connection closed');
			isConnectionOpen = false;
		};

		socket.onmessage = function (msg) {
			var message = JSON.parse(msg.data);
			console.log('my message: ' + JSON.stringify(message));

			if (message.type === 'TAGS') {
				var checkboxes = $('#checkboxes');
				for (var i = 0; i < message.tags.length; i++) {
					if (tags.indexOf(message.tags[i]['shortId']) >= 0) continue;

					var checkbox = $('<input name="tag" checked type="checkbox" value="' + message.tags[i]['shortId'] + '">');
					var wrapper = $('<span>' + message.tags[i]['shortId'] + '</span>');
					checkbox.change(function() {
						socket.send($(this).val());
					});
					wrapper.css({
						'color': getColor(message.tags[i]['shortId'])
					});
					wrapper.append(checkbox);
					checkboxes.append(wrapper);
					tags.push(message.tags[i]['shortId']);
				}
			} else if (message.type === 'COORDINATES') {
				var $el = $('<div class="square"></div>');
				console.log('Received: ');
				console.log(message['coordinatesDto']);
				$el.css({
					'left': 250 + message['coordinatesDto']['point'].x,
					'top': 400 + message['coordinatesDto']['point'].y,
					'background-color': getColor(message['coordinatesDto']['deviceId'])
				});
				$container.append($el);
			}
		};

		function getColor(deviceId) {
			return {
				10151: 'blue',
				10404: 'purple',
				10210: 'green',
				10310: 'pink'
			}[deviceId];
		}

		var anchors = [
			{
				x: 0,
				y: 0
			},
			{
				x: 785,
				y: 0
			},
			{
				x: 485,
				y: 397
			}
		];
		for (var j = 0; j < anchors.length; j++) {
			var $el = $('<div class="square red"></div>');
			$el.css({
				'left': 250 + anchors[j].x,
				'top': 400 + anchors[j].y
			});
			$container.append($el);
		}
	});
</script>
</html>