<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<style>
    #container {
        width: 1500px;
        height: 1500px;
        background: grey;
	    position: relative;
    }

    .square {
        width: 5px;
        height: 5px;
        background: white;
        position: absolute;
    }

	#color {
		display: none;
	}

	.red {
		background-color: red;
	}
</style>
<body>
<div id="container">
	<form>
		<div id="checkboxes"></div>
	</form>
</div>
<select title="color" id="color">
	<option value="white">white</option>
	<option value="black">black</option>
	<option value="red">red</option>
	<option value="pink">pink</option>
	<option value="green">green</option>
</select>
</body>
<script
        src="https://code.jquery.com/jquery-3.1.1.min.js"
        integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
        crossorigin="anonymous"></script>
<script>
    $(document).ready(function () {
	    var $container = $('#container');

	    var isConnectionOpen = false;
	    var socket = new WebSocket("ws://localhost:80/coordinates?client");
	    var message = {
		    color: ''
	    };
	    socket.onopen = function () {
		    console.log('connection opened');
		    isConnectionOpen = true;
	    };

	    socket.onclose = function() {
		    console.log('connection closed');
		    isConnectionOpen = false;
	    };

	    function getColor(RGB, colorInt) {
	    	var color;
	    	if (colorInt <= 16) {
	    		color = '0' + colorInt.toString(16);
		    } else {
	    		color = colorInt.toString(16)
		    }
	    	if (RGB == 0) {
	    		return '#0000' + color
		    } else if (RGB == 1) {
	    		return '#00' + color + 'ff';
		    } else if (RGB == 2) {
	    		return '#' + color + 'ffff';
		    }
	    }

	    var colorInt = 0;
	    var RGB = 0;

	    function createNewCheckbox(div, value){
			    div.append(
			    $(document.createElement("label")).html(value).prepend(
				    $(document.createElement("input")).attr('name', 'shortId').attr('value', value).attr('type', 'checkbox').attr('checked', true)
			    )
		    );
	    }

	    socket.onmessage = function (msg) {
		    var message = JSON.parse(msg.data);
		    console.log('my message: ' + JSON.stringify(message));

		    if (message.type == "TAGS"){
		    	for (var i = 0; i < message.tags.length; i++){
		    		createNewCheckbox($('#checkboxes'), message.tags[i].shortId);
			    }
		    }

			var $el = $('<div class="square"></div>');
			var color = getColor(RGB, colorInt);
			console.log(color);
			$el.css({
				'left': 250 + message.x,
				'top': 400 + message.y,
				'background-color': color
			});
			$container.append($el);
			colorInt += 3;
			if (colorInt > 255) {
				RGB++;
				colorInt = 0;
			}
		    //{"type":"COORDINATES","coordinatesDto":{"device":"test","x":627,"y":182}}
	    };

	    var anchors = [
	    	{
		        x: 0,
			    y: 0
	        },
		    {
		    	x: 785,
			    y: 0
		    },
		    {
		    	x: 485,
			    y: 397
		    }
	    ];
	    for (var j = 0; j < anchors.length; j++) {
		    var $el = $('<div class="square red"></div>');
		    $el.css({
			    'left': 250+ anchors[j].x,
			    'top': 400 + anchors[j].y
		    });
		    $container.append($el);
	    }

        var interval = null;
	    interval = setInterval(function() {
	    	console.log('waiting for connection');
        	if (isConnectionOpen) {
		        var $color = $('#color');
		        $color.change(function() {
			        message.color = $color.find('option:selected').val();
			        socket.send(JSON.stringify(message));
		        });
		        clearInterval(interval);
		        $color.show();
	        }
        }, 1000);
    });
</script>
</html>