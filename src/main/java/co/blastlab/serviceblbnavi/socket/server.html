<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<style>
    #container {
        width: 500px;
        height: 500px;
        background: darkgray;
        position: relative;
    }

    .square {
        width: 5px;
        height: 5px;
        position: absolute;
    }

    .white {
	    background: white;
    }

	.black {
		background: black;
	}

	.red {
		background: red;
	}

	.pink {
		background: pink;
	}

	.green {
		background: green;
	}
</style>
<body>
<div id="container">
</div>
</body>
<script
        src="https://code.jquery.com/jquery-3.1.1.min.js"
        integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
        crossorigin="anonymous"></script>
<script>
    $(document).ready(function () {
        var isConnectionOpen = false;
        var socket = new WebSocket("ws://localhost:80/coordinates?server");
        var message = {
            x: 0,
            y: 0
        };
        var coordinates = [
            {
            	x: 3,
                y: 0
            },
	        {
		        x: 3,
		        y: -1
	        },
	        {
		        x: 3,
		        y: -2
	        },
	        {
		        x: 3,
		        y: -3
	        },
	        {
		        x: 4,
		        y: -3
	        },
	        {
		        x: 5,
		        y: -3
	        },
            {
		        x: 6,
		        y: -3
	        },
	        {
		        x: 6,
		        y: -4
	        },
	        {
		        x: 6,
		        y: -5
	        },
	        {
		        x: 7,
		        y: -5
	        },
	        {
		        x: 8,
		        y: -5
	        },
	        {
		        x: 8,
		        y: -4
	        },
	        {
		        x: 8,
		        y: -3
	        },
	        {
		        x: 8,
		        y: -2
	        }


        ];
        var getDistances = function(x, y) {
        	return [
                {
                	d1: 1,
                    d2: 32768,
                    dist: Math.sqrt(Math.pow(x, 2) + Math.pow(y, 2)) * 100
                },
		        {
			        d1: 1,
			        d2: 32769,
			        dist: Math.sqrt(Math.pow(10 - x, 2) + Math.pow(y, 2)) * 100
		        },
		        {
			        d1: 1,
			        d2: 32770,
			        dist: Math.sqrt(Math.pow(x, 2) + Math.pow(10 - y, 2)) * 100
		        }
            ]
        };

        var color = 'white';

        socket.onopen = function () {
        	console.log('connection opened');
        	isConnectionOpen = true;

        	for(var i = 0; i < coordinates.length; i++) {
		        for(var j = 0; j < getDistances(coordinates[i].x, coordinates[i].y).length; j++) {
			        socket.send(JSON.stringify(getDistances(coordinates[i].x, coordinates[i].y)[j]));
		        }
	        }
        };

        socket.onclose = function() {
        	console.log('connection closed');
        	isConnectionOpen = false;
        };

        socket.onmessage = function (msg) {
        	console.log(msg)
            var message = JSON.parse(msg.data);
//            color = message.color;
//            console.log('new color is: ', color)
	        var $el = $('<div class="square red"></div>');
	        $el.css({
		        'left': message.x * 150,
		        'top': message.y * 150
	        });
	        $container.append($el);
        };

        var $container = $('#container');
        $container.on('click', function (evt) {
            if (!isConnectionOpen) {
                return;
            }
            var $el = $('<div class="square"></div>');
            $el.addClass(color);
            $el.css({
                'left': evt.pageX,
                'top': evt.pageY
            });
            $container.append($el);
            message.x = evt.pageX;
            message.y = evt.pageY;
            socket.send(JSON.stringify(message));
        });
    });
</script>
</html>